<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Hello Guys!!</h1>
    <div id="form"></div>
    <br>
    <hr>
    <div id="table"></div>
    <script>
        let members = [];
        getItem();
        openAddForm();
        renderTable();


        // Session Storage

        function getItem() {
            let memData = sessionStorage.getItem('members');
            if (memData) {
                members = JSON.parse(memData);
            } else {
                setItem();
            }
        }
        function setItem() {
            sessionStorage.setItem('members', JSON.stringify(members));
        }
        // LocalStorage
        /*
        function getItem() {
                let memData = localStorage.getItem('members');
                if (memData) {
                    members = JSON.parse(memData);
                } else {
                    setItem();
                }
            }
            function setItem() {
                localStorage.setItem('members', JSON.stringify(members));
            }
            */
        function addMember() {

            let name = document.getElementById('name').value;
            let age = document.getElementById('age').value;

            let member = {
                'name': name,
                'age': age
            };
            members.push(member);

            setItem()


            document.getElementById('name').value = '';
            document.getElementById('age').value = ''

            renderTable();

        }

        function deleteMember(index) {
            members.splice(index, 1); // 1: startIndex 2: numElem
            setItem()
            renderTable();
        }
        function editMember(index) {
            let newName = document.getElementById('name').value;
            let newAge = document.getElementById('age').value;
            members[index] = {
                name: newName,
                age: newAge
            }

            setItem();

            document.getElementById('form').innerHTML = '';
            openAddForm();
            renderTable();
        }
        function openAddForm() {
            let str = `
                <fieldset>
                    <legend>Add Member</legend>
                    <input type='text' id='name'  />
                    <input type='number' id='age' />
                    <button onclick='addMember()'>Add</button>
                </fieldset>
            `;
            document.getElementById('form').innerHTML = str;
        }
        function openEditForm(index) {
            let str = `
                <fieldset>
                    <legend>Edit Member</legend>
                    <input type='text' id='name' value='${members[index].name}'  />
                    <input type='number' id='age' value='${members[index].age}' />
                    <button onclick='editMember(${index})'>Update</button>
                </fieldset>
            `;
            document.getElementById('form').innerHTML = str;
        }
        function renderTable() {

            let tableStr = `<table border='1'>`;
            tableStr = tableStr + `<tr><th>Name</th><th>Age</th></tr>`;

            for (let i = 0; i < members.length; i++) {
                tableStr = tableStr + `<tr>
                    <td>${members[i].name}</td>
                    <td>${members[i].age}</td>
                    <td><button onclick="openEditForm(${i})">edit</button></td>
                    <td><button onclick="deleteMember(${i})">delete</button></td>
                    </tr>`
            }
            tableStr = tableStr + `</table>`;

            document.getElementById('table').innerHTML = tableStr;
        }

    </script>
</body>

</html>
